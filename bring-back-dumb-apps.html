<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Draggable Elements with CSS Editor</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/codemirror.min.css"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        background-color: #f0f0f0;
      }
      #wrapper {
        position: relative;
        width: 75%;
        height: 100vh;
        overflow: hidden;
        background-color: #f0f0f0;
        border-right: 1px solid #ccc;
      }
      #controls {
        padding: 20px;
        background-color: #ffffff;
        border-bottom: 1px solid #ccc;
      }
      .text-box,
      .image-container {
        position: absolute;
        background-color: white;
        border: 1px solid #ccc;
        padding: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        cursor: move;
        resize: both;
        overflow: hidden;
        min-width: 100px;
        min-height: 24px;
      }
      .image-container[contenteditable="true"],
      .text-box[contenteditable="true"] {
        outline: 2px dashed #007bff;
      }
      .draggable-image {
        pointer-events: none;
        width: 100%;
        height: 100%;
        object-fit: fill;
        font-size: 0px;
      }
      .selected {
        outline: 2px solid blue;
      }
      #css-editor-container {
        width: 25%;
        height: 100vh;
        overflow: auto;
      }
      #css-editor {
        height: 100%;
      }
      button,
      input {
        display: block;
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <div id="wrapper"></div>
    <div id="css-editor-container" class="controls">
      <button onclick="addTextBox()">Add Text Box</button>
      <input
        type="file"
        id="imageUpload"
        accept="image/*"
        onchange="addImage(event)"
      />
      <textarea id="css-editor">/* Write your CSS here */</textarea>
      <input
        type="text"
        id="classInput"
        placeholder="Enter class name"
        onkeypress="if(event.key === 'Enter') applyClassToSelected()"
      />
      <button onclick="applyClassToSelected()">Add Class to Selected</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.7/mode/css/css.min.js"></script>
    <script>
      let lastSelected = null;

      // Initialize CodeMirror for the CSS editor
      const styleTag = document.createElement("style");
      document.head.appendChild(styleTag);

      const cssEditor = CodeMirror.fromTextArea(
        document.getElementById("css-editor"),
        {
          mode: "css",
          lineNumbers: true,
          theme: "default",
        }
      );

      cssEditor.on("change", () => {
        styleTag.textContent = cssEditor.getValue();
      });

      function createDraggableElement(element) {
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        const wrapper = document.getElementById("wrapper");
        const wrapperRect = wrapper.getBoundingClientRect();

        element.addEventListener("mousedown", function (e) {
          if (lastSelected) {
            lastSelected.classList.remove("selected");
          }

          element.classList.add("selected");
          lastSelected = element;

          dragStart(e);
        });

        document.addEventListener("mousemove", drag);
        document.addEventListener("mouseup", dragEnd);

        
        element.addEventListener("dblclick", toggleEditable);
        

        document.addEventListener("keydown", function (e) {
          if (e.ctrlKey && e.key === "d" && lastSelected) {
            e.preventDefault();
            lastSelected.remove();
            lastSelected = null;
          }
        });

        function toggleEditable(e) {
          if (element.contentEditable !== "true") {
            element.contentEditable = "true";
            element.focus();
          } else {
            element.contentEditable = "false";
          }
        }

        function dragStart(e) {
          if (element.contentEditable === "true") return;

          initialX = e.clientX - wrapperRect.left - xOffset;
          initialY = e.clientY - wrapperRect.top - yOffset;
          isDragging = true;
        }

        function drag(e) {
          if (isDragging) {
            e.preventDefault();

            const mouseX = e.clientX - wrapperRect.left;
            const mouseY = e.clientY - wrapperRect.top;

            currentX = mouseX - initialX;
            currentY = mouseY - initialY;

            xOffset = currentX;
            yOffset = currentY;

            setTranslate(currentX, currentY, element);
          }
        }

        function dragEnd(e) {
          initialX = currentX;
          initialY = currentY;
          isDragging = false;
        }

        function setTranslate(xPos, yPos, el) {
          el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
        }
      }

      function addTextBox() {
        const wrapper = document.getElementById("wrapper");
        const textBox = document.createElement("div");
        textBox.className = "text-box";
        textBox.textContent = "Double-click to edit";
        wrapper.appendChild(textBox);
        createDraggableElement(textBox);
      }

      function addImage(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const wrapper = document.getElementById("wrapper");
            const imageContainer = document.createElement("div");
            imageContainer.className = "image-container";

            const img = document.createElement("img");
            img.src = e.target.result;
            img.className = "draggable-image";

            imageContainer.appendChild(img);
            wrapper.appendChild(imageContainer);
            createDraggableElement(imageContainer);
          };
          reader.readAsDataURL(file);
        }
      }

      function applyClassToSelected() {
        const classInput = document.getElementById("classInput");
        const className = classInput.value.trim();
        if (lastSelected && className) {
          lastSelected.classList.add(className);
          classInput.value = ""; // Clear input after applying
        } else if (!lastSelected) {
          alert("Please select an element first!");
        }
      }
    </script>
  </body>
</html>
